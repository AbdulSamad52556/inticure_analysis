{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="{{url_for('static',filename='assets/css/survey.css')}}">
<link rel="stylesheet" href="{{url_for('static',filename='assets/css/transitions.css')}}">

<div class="container">
    <div class="col-sm-12">
        <div class="mm-survey">

            <div class="mm-survey-progress">
                <div class="mm-survey-progress-bar mm-progress"></div>
            </div>

            <div class="mm-survey-results">
                <div class="mm-survey-results-container">
                    <h3 class="mm-survey-results-score"></h3>
                    <ul class="mm-survey-results-list"></ul>
                </div>
                <div class="mm-survey-results-controller">
                    <div class="mm-back-btn">
                        <button>Back</button>
                    </div>
                </div>
            </div>

            <div class="mm-survey-bottom">
                <div class="mm-survey-container">

                    <main id="swup" class="transition-fade">
                    <div class="mm-survey-page active" data-page="1">
                        <div class="mm-survery-content">
                            <div class="mm-survey-question">
                                <p>Based on history... What is the ideal color for a Ferrari?</p>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio01" data-item="1" name="radio1" value="red" />
                                <label for="radio01"><span></span><p>Red</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio02" data-item="1" name="radio1" value="blue" />
                                <label for="radio02"><span></span><p>Blue</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio03" data-item="1" name="radio1" value="green" />
                                <label for="radio03"><span></span><p>Green</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio04" data-item="1" name="radio1" value="purple" />
                                <label for="radio04"><span></span><p>Purple</p></label>
                            </div>
                        </div>
                    </div>
                </main>
                    <div class="mm-survey-page" data-page="2">
                        <div class="mm-survery-content">
                            <div class="mm-survey-question">
                                <p>Which one of these car brands is made in Germany?</p>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio05" data-item="2" name="radio2" value="honda" />
                                <label for="radio05"><span></span><p>Honda</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio06" data-item="2" name="radio2" value="ford" />
                                <label for="radio06"><span></span><p>Ford</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio07" data-item="2" name="radio2" value="mercedes" />
                                <label for="radio07"><span></span><p>Mercedes</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio08" data-item="2" name="radio2" value="ferrari" />
                                <label for="radio08"><span></span><p>Ferrari</p></label>
                            </div>
                        </div>
                    </div>
                    <div class="mm-survey-page" data-page="3">
                        <div class="mm-survery-content">
                            <div class="mm-survey-question">
                                <p>Which is the correct integer for Pi?</p>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio09" data-item="3" name="radio3" value="3" />
                                <label for="radio09"><span></span><p>3</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio10" data-item="3" name="radio3" value="4" />
                                <label for="radio10"><span></span><p>4</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio11" data-item="3" name="radio3" value="3.41" />
                                <label for="radio11"><span></span><p>3.41</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio12" data-item="3" name="radio3" value="3.14" />
                                <label for="radio12"><span></span><p>3.14</p></label>
                            </div>
                        </div>
                    </div>
                    <div class="mm-survey-page" data-page="4">
                        <div class="mm-survery-content">
                            <div class="mm-survey-question">
                                <p>The letter 'C' is the nth number in the alphabet, choose the correct number.</p>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio13" data-item="4" name="radio4" value="1" />
                                <label for="radio13"><span></span><p>1</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio14" data-item="4" name="radio4" value="2" />
                                <label for="radio14"><span></span><p>2</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio15" data-item="4" name="radio4" value="3" />
                                <label for="radio15"><span></span><p>3</p></label>
                            </div>
                            <div class="mm-survey-item">
                                <input type="radio" id="radio16" data-item="4" name="radio4" value="4" />
                                <label for="radio16"><span></span><p>4</p></label>
                            </div>
                        </div>
                    </div>
                    <!-- <div class="mm-survey-page" data-page="5">
                        <div class="mm-survery-content">

                        </div>
                    </div>
                    <div class="mm-survey-page" data-page="6">
                        <div class="mm-survery-content">

                        </div>
                    </div>
                    <div class="mm-survey-page" data-page="7">
                        <div class="mm-survery-content">

                        </div>
                    </div> -->
                    
                </div>

                <div class="mm-survey-controller">
                    <div class="mm-prev-btn">
                        <button>Prev</button>
                    </div>
                    <div class="mm-next-btn">
                        <button disabled="true">Next</button>
                    </div>
                    <div class="mm-finish-btn">
                        <button>Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{url_for('static',filename='js/vendors/jquery-steps/jquery.steps.js')}}"> </script>
<script src="{{url_for('static',filename='js/vendors/jquery-steps/jquery.steps.min.js')}}"> </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://unpkg.com/swup@latest/dist/swup.min.js"></script> 
<script src="{{url_for('static',filename='js/transition.js')}}"></script>

<script>
    jQuery(document).ready(function ($) {
    $('.mm-prev-btn').hide();

        var x;
        var count;
        var current;
        var percent;
        var z = [];

        init();
        getCurrentSlide();
        goToNext();
        goToPrev();
        getCount();
        // checkStatus();
        // buttonConfig();
        buildStatus();
        deliverStatus();
        submitData();
        goBack();

        function init() {
            
            $('.mm-survey-container .mm-survey-page').each(function() {

                var item;
                var page;

                item = jQuery(this);
                page = item.data('page');

                item.addClass('mm-page-'+page);
                //item.html(page);

            });

        }

        function getCount() {

            count = $('.mm-survey-page').length;
            return count;

        }

        function goToNext() {

            $('.mm-next-btn').on('click', function() {
                goToSlide(x);
                getCount();
                current = x + 1;
                var g = current/count;
                buildProgress(g);
                var y = (count + 1);
                getButtons();
                $('.mm-survey-page').removeClass('active');
                $('.mm-page-'+current).addClass('active');
                getCurrentSlide();
                checkStatus();
                if( $('.mm-page-'+count).hasClass('active') ){
                    if( $('.mm-page-'+count).hasClass('pass') ) {
                        $('.mm-finish-btn').addClass('active');
                    }
                    else {
                        $('.mm-page-'+count+' .mm-survery-content .mm-survey-item').on('click', function() {
                            $('.mm-finish-btn').addClass('active');
                        });
                    }
                }
                else {
                    $('.mm-finish-btn').removeClass('active');
                    if( $('.mm-page-'+current).hasClass('pass') ) {
                        $('.mm-survey-container').addClass('good');
                        $('.mm-survey').addClass('okay');
                    }
                    else {
                        $('.mm-survey-container').removeClass('good');
                        $('.mm-survey').removeClass('okay');
                    }
                }
                buttonConfig();
            });

        }

        function goToPrev() {

            $('.mm-prev-btn').on('click', function() {
                goToSlide(x);
                getCount();			
                current = (x - 1);
                var g = current/count;
                buildProgress(g);
                var y = count;
                getButtons();
                $('.mm-survey-page').removeClass('active');
                $('.mm-page-'+current).addClass('active');
                getCurrentSlide();
                checkStatus();
                $('.mm-finish-btn').removeClass('active');
                if( $('.mm-page-'+current).hasClass('pass') ) {
                    $('.mm-survey-container').addClass('good');
                    $('.mm-survey').addClass('okay');
                }
                else {
                    $('.mm-survey-container').removeClass('good');
                    $('.mm-survey').removeClass('okay');
                }
                buttonConfig();
            });

        }

        function buildProgress(g) {

            if(g > 1){
                g = g - 1;
            }
            else if (g === 0) {
                g = 1;
            }
            g = g * 100;
            $('.mm-survey-progress-bar').css({ 'width' : g+'%' });

        }

        function goToSlide(x) {

            return x;

        }

        function getCurrentSlide() {

            $('.mm-survey-page').each(function() {

                var item;

                item = $(this);

                if( $(item).hasClass('active') ) {
                    x = item.data('page');
                }
                else {
                    
                }

                return x;

            });

        }

        function getButtons() {

            if(current === 0) {
                current = y;
            }
            if(current === count) {
                $('.mm-next-btn').hide();
            }
            else if(current === 1) {
                $('.mm-prev-btn').hide();
            }
            else {
                $('.mm-next-btn').show();
                $('.mm-prev-btn').show();
            }

        }

        $('.mm-survey-q li input').each(function() {

            var item;
            item = $(this);

            $(item).on('click', function() {
                if( $('input:checked').length > 0 ) {
                    // console.log(item.val());
                    $('label').parent().removeClass('active');
                    item.closest( 'li' ).addClass('active');
                }
                else {
                    //
                }
            });

        });

        percent = (x/count) * 100;
        $('.mm-survey-progress-bar').css({ 'width' : percent+'%' });

        function checkStatus() {
            $('.mm-survery-content .mm-survey-item').on('click', function() {
                var item;
                item = $(this);
                item.closest('.mm-survey-page').addClass('pass');
            });
        }

        function buildStatus() {
            $('.mm-survery-content .mm-survey-item').on('click', function() {
                var item;
                item = $(this);
                item.addClass('bingo');
                item.closest('.mm-survey-page').addClass('pass');
                $('.mm-survey-container').addClass('good');
            });
        }

        function deliverStatus() {
            $('.mm-survey-item').on('click', function() {
                if( $('.mm-survey-container').hasClass('good') ){
                    $('.mm-survey').addClass('okay');
                }
                else {
                    $('.mm-survey').removeClass('okay');	
                }
                buttonConfig();
            });
        }

        function lastPage() {
            if( $('.mm-next-btn').hasClass('cool') ) {
                alert('cool');
            }
        }

        function buttonConfig() {
            if( $('.mm-survey').hasClass('okay') ) {
                $('.mm-next-btn button').prop('disabled', false);
            }
            else {
                $('.mm-next-btn button').prop('disabled', true);
            }
        }

        function submitData() {
            $('.mm-finish-btn').on('click', function() {
                collectData();
                $('.mm-survey-bottom').slideUp();
                $('.mm-survey-results').slideDown();
            });
        }

        function collectData() {
            
            var map = {};
            var ax = ['0','red','mercedes','3.14','3'];
            var answer = '';
            var total = 0;
            var ttl = 0;
            var g;
            var c = 0;

            $('.mm-survey-item input:checked').each(function(index, val) {
                var item;
                var data;
                var name;
                var n;

                item = $(this);
                data = item.val();
                name = item.data('item');
                n = parseInt(data);
                total += n;

                map[name] = data;

            });

            $('.mm-survey-results-container .mm-survey-results-list').html('');

            for (i = 1; i <= count; i++) {

                var t = {};
                var m = {};
                answer += map[i] + '<br>';
                
                if( map[i] === ax[i]) {
                    g = map[i];
                    p = 'correct';
                    c = 1;
                }
                else {
                    g = map[i];
                    p = 'incorrect';
                    c = 0;
                }

                $('.mm-survey-results-list').append('<li class="mm-survey-results-item '+p+'"><span class="mm-item-number">'+i+'</span><span class="mm-item-info">'+g+' - '+p+'</span></li>');

                m[i] = c;
                ttl += m[i];

            }

            var results;
            results = ( ( ttl / count ) * 100 ).toFixed(0);

            $('.mm-survey-results-score').html( results + '%' );

        }

        function goBack() {
            $('.mm-back-btn').on('click', function() {
                $('.mm-survey-bottom').slideDown();
                $('.mm-survey-results').slideUp();
            });
        }
    });
</script>
 


{% endblock %}